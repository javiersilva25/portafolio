<app-perfil #perfilRef style="display: none"></app-perfil>
<ion-header>
  <ion-toolbar>
    <ion-title>Registro Nutricional Diario</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

<ion-card class="fecha-selector-card">
  <ion-card-header>
    <ion-card-title>Seleccionar Fecha</ion-card-title>
  </ion-card-header>
  <ion-card-content class="fecha-selector">
    <ion-button fill="clear" (click)="cambiarFecha(-1)">
      <ion-icon name="chevron-back-outline"></ion-icon>
    </ion-button>

    <span class="fecha-texto">{{ fechaHoy | date:'shortDate' }}</span>

    <ion-button fill="clear" (click)="cambiarFecha(1)">
      <ion-icon name="chevron-forward-outline"></ion-icon>
    </ion-button>
  </ion-card-content>
</ion-card>



<ion-card class="resumen-total-card">
  <ion-card-header>
    <ion-card-title>Resumen Nutricional del Día</ion-card-title>
  </ion-card-header>
  <ion-card-content>

    <div class="macro-row">
      <span><strong>Calorías:</strong> {{ totalCalorias | number:'1.0-0' }} / {{ caloriasFinales | number:'1.0-0' }} kcal</span>
      <ion-progress-bar [value]="totalCalorias / caloriasFinales"></ion-progress-bar>
    </div>

    <div class="macro-row">
      <span><strong>Carbohidratos:</strong> {{ totalCarbohidratos | number:'1.0-1' }} / {{ carbohidratosObjetivos | number:'1.0-1' }} g</span>
      <ion-progress-bar [value]="totalCarbohidratos / carbohidratosObjetivos"></ion-progress-bar>
    </div>

    <div class="macro-row">
      <span><strong>Proteínas:</strong> {{ totalProteinas | number:'1.0-1' }} / {{ proteinasObjetivos | number:'1.0-1' }} g</span>
      <ion-progress-bar [value]="totalProteinas / proteinasObjetivos"></ion-progress-bar>
    </div>

    <div class="macro-row">
      <span><strong>Grasas:</strong> {{ totalGrasas | number:'1.0-1' }} / {{ grasasObjetivos | number:'1.0-1' }} g</span>
      <ion-progress-bar [value]="totalGrasas / grasasObjetivos"></ion-progress-bar>
    </div>

  </ion-card-content>
</ion-card>


  <div *ngFor="let tipo of tiposComida">
    <ion-card>
      <ion-card-header>
        <ion-card-title>{{ tipo | titlecase }}</ion-card-title>
      </ion-card-header>

      <ng-container *ngIf="comidas[tipo] && comidas[tipo].length > 0; else sinAlimentos">
        <ion-list>
          <ion-item-sliding *ngFor="let alimento of comidas[tipo]; let i = index">
            <ion-item>
              <ion-label>
                <h4>{{ alimento.nombre }} - {{ alimento.gramos }}g</h4>
                <p>
                  {{ alimento.calorias | number:'1.0-0' }} kcal |
                  C: {{ alimento.carbohidratos | number:'1.0-1' }}g |
                  P: {{ alimento.proteinas | number:'1.0-1' }}g |
                  G: {{ alimento.grasas | number:'1.0-1' }}g
                </p>
              </ion-label>
            </ion-item>
            <ion-item-options side="end">
              <ion-item-option color="primary" (click)="editarAlimento(tipo, i)">
                <ion-icon name="create-outline"></ion-icon>
              </ion-item-option>
              <ion-item-option color="danger" (click)="eliminarAlimento(tipo, i)">
                <ion-icon name="trash-outline"></ion-icon>
              </ion-item-option>    
            </ion-item-options>       
          </ion-item-sliding>
        </ion-list>
      </ng-container>

      <ng-template #sinAlimentos>
        <ion-item>
          <ion-label>No hay alimentos añadidos.</ion-label>
        </ion-item>
      </ng-template>

      <ion-button expand="block" (click)="abrirModal(tipo)">
        + Agregar alimento
      </ion-button>
    </ion-card>
  </div>

</ion-content>
